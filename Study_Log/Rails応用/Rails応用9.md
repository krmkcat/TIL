# 2023.12.13
いきなりブランチ名をミスタイプしてしまった。ブランチの名前変更の仕方をTILに投げたので次からはこれを見れば検索せずにすむ。

無事ブランチ名を直したところで今回の課題の概要把握。

faviconはわかるけどog-imageってなに？っていうのと、そもそもその2つを設定してもどこに反映されてるのかわからんっていうのがまず疑問だな。

う〜んSafariでも見てみたけどやっぱりわからないな。faviconってブラウザのタブとかブックマークリストの頭につくあのアイコンのことだと思うんだけど出てない。

調べてみたけどfaviconの意味はやっぱりあってそう。う〜んローカルだと出ないとか？？とりあえず保留にして、og-imageについても調べてみるか。

og-imageとは、Facebook や Twitter などの SNS で記事をシェアしたときに表示される画像。OGP（Open Graph Protocol）の略で、Web サイトのコンテンツを SNS で伝える際に使用される。とのこと。例↓  
参考記事：[OGPとは？OGPの基本からOGP画像のサイズや設定方法を分かりやすく解説](https://www.itra.co.jp/webmedia/what-is-ogp.html)

![OGPの例](image.png)


faviconが表示されてないという謎はあるけど、一旦先に進んでしまおう。

今回の課題の概要
- トップ画像を管理画面から登録・削除できるようにする
  - その際、一度に複数登録できるようにする
  - 削除は個別にできるように
- faviconやog-imageも個別に削除できるようにする（登録は最初からできる状態）
- トップ画像は複数の画像が一定感覚で切り替わるようにする（swiperというJQueryプラグインを使う）

こんな感じだな。  
よし、コードリーディングして諸々確認しながらタスク書き出してみよう。

- [ ] トップ画像
  - [ ] モデルに`has_many_attached`を追加
  - [ ] `swiper`を導入
  - [ ] `shared/_header.html.slim`にトップ画像を表示するコードを追加
  - [ ] サイト設定編集フォームにフィールドを追加
  - [ ] Admin::Sitesコントローラを修正
- [ ] faviconとog-image
  - [ ] サイト設定編集フォームに削除ボタン追加
  - [ ] Admin::Sitesコントローラを修正

とりあえずこんなもんか。他にもあったら後から追加で。

さて早速取り掛かろう。まずは比較的シンプルそうなfaviconとog-imageから。

アップロード済の画像を削除するにはどうしたらいいか考えなきゃいけないな。Railsガイドになんか載ってないかな。

お、やっぱりあった。  
[Railsガイド](https://railsguides.jp/active_storage_overview.html#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B)

画像は削除ボタン押した瞬間に消えてるっぽいな。Rails基礎でやったブックマークの解除みたいな感じで実装すればいいのかな？当時の記録を見てみよう。

TurboStreamの使い方は一応メモってあった。ただ、これも確かに関係してるかもなんだけど、そのまえに「ボタンを押したらこのメソッドが実行される」っていうロジックを組まなきゃいけないんだよね。  
コントローラに通常のCRUD以外のカスタムアクションを作ればいいのか？それって有りなんだろうか。  
あるいはJavascript使うとか？

カスタムアクションはやっぱり望ましくないっぽい。それよりはサブコントローラを作るほうが良さそうだな。  
参考記事：[DHH流のルーティングで得られるメリットと、取り入れる上でのポイント](https://tech.kitchhike.com/entry/2017/03/07/190739)

今日はここまで。明日はアップロード済画像の削除ボタンの仕組みを引き続き考える。

# 2023.12.14
画像の削除ボタンについて引き続き考える。そもそもアップロードのときはどうしてるんだっけ。

フォームから添付ファイルを受け取って保存する場合は`= f.input :eye_catch, as: :file`みたいにアタッチメント名（っていう言い方していいのかはわからないが）を指定することで他の属性と一緒くたに扱えるんだな。  
とりあえずサブコントローラ方式でやってみるか。`rails g controller namespace/コントローラ名`だな。どういう構成にするべきかな？？URLは`.../admin/site/images`みたいにしたい。ということは`rails g controller admin::site/images`でいいのかな。namespaceの入れ子ってこれでいいんだろうか。

ルーティングは`module`を使った書き方にした。参考記事：[【Rails】 ルーティングのnamespace, module, scopeの違い](https://zenn.dev/kanazawa/articles/37e22059af576f)

`rails g controller admin::site/images`なのか`rails g controller admin/site/images`なのか…。まあいいや間違ってたら`rails d`すればいいんだしとにかくやってみよう。

よし、コントローラとルーティングできた。`rails g controller admin/site/images`で良かったみたいだ。早速ボタンを作ってみよう。

ん〜うまく動いてないな。というか指定したURLにデータが飛んでない感じだ。なんでだろ。

今日はここまで。明日は削除ボタンの続きから。

# 2023.12.15
削除ボタンの実装続き。ボタンのリンクが生きてないのはなんでだろう。

あ〜なるほど、`button_to`はフォームを生成してその中にボタンを作るってことになるのか。だからフォームの中では使えないんだ。`link_to`だとできるのかな？

お、できるっぽい！あと今回はTurbo使ってないみたいで、素直に`method: :delete`って書いたほうがうまくいった。Rails7だからって必ずしもTurbo仕様とは限らないんだな。  
パラメータの受け渡しがうまくいってないみたいなのでそこを調べる。

パスの後ろに`(キー: 値, ...)`ってつければいいんだな。参考記事：[【Rails】link_toに任意のパラメータを付与する方法](https://310nae.com/linkto-param/)

よし！あんまりスマートなやり方じゃないかもだけどとりあえずできた！あとは見た目を整えるのと、余裕があればajax化すればいいか。  
見た目は後でまとめてやればいいから、トップ画像の方に移ろう。

今日はここまで。明日はトップ画像の複数登録とスライダー表示に着手する。