# 2023.12.3
ブランチも切ったのでさっそく課題の概要を確認。

なるほど。
- アイキャッチ画像横幅用のカラムをモデルに追加
- 記事編集用のフォームを修正
- 記事プレビューおよび公開用のビューを修正

大まかにはこんな感じかな。

アイキャッチ画像はどのモデルで扱ってるんだ？まずそこを確認しなきゃ。

あ〜また知らんやつ出てきた〜。Articleモデルで`has_one_attached: :eye_catch`してる。なお`EyeCatch`というモデルはない。ひょっとすると`Medium`モデルあたりと関係合ったりするのかな？  
`Medium`モデル見てみたらこっちにも`has_one_attached: :attached`という記述あり。  
なにはともあれ`has_one_attached`というアソシエーションについて調べる。

お、どうもActiveStorageなるものに関係しているっぽい。名前だけは聞いたことあるな。[公式ドキュメント](https://railsguides.jp/active_storage_overview.html)読もう。

なんとなくはわかった。クラウドストレージサービスとの橋渡しをしてるんだな。だからアプリ内にはモデルがないんだ。`has_one_attached`はいわゆるアソシエーションとはまた別の概念だなたぶん。  
ということは`eye_catch_width`カラムはArticleモデルに追加すればいいな。で、ビューで表示するときは`eye_catch_width`を横幅に指定すると。  
さっきよりもう少し詳しくタスク書き出すとこんな感じか。

- [x] アイキャッチ横幅用のカラムをモデルに追加
- [ ] アイキャッチ配置用のカラムをモデルに追加
- [ ] 記事編集用のフォームを修正
  - [ ] アイキャッチ横幅を入力する数値フィールドを追加
  - [ ] アイキャッチ配置を選択するラジオボタンを追加
- [ ] 記事プレビューおよび公開用のビューを修正
  - [ ] 横幅と配置を指定する

よし、まずカラムの追加から始めよう。マイグレーションファイルを生成する。

カラムを追加するときにマイグレーションファイルを生成する方法、完全に忘れてるわ…。絶対また忘れるからあとでちゃんとTILに放り込んでおこう。とりあえず`rails d`してやり直す。

`eyecatch_align`は`null: false`でデフォルト値設定しちゃってOKだろうけど、`eyecatch_width`はどうするべきだ？？

う〜〜〜ん、見本アプリで試してみたところ、横幅を入力せずに更新ボタン押すとエラーになるときとならないときがあるな。ここはちょっとよくわからない。  
空欄のままだと、横幅が700超える画像の場合は勝手に700に縮小されるっぽい。100より小さい画像はもってないから試してないけど、たぶん100に拡大されるんじゃないかな。  
つまり横幅を指定しない場合の挙動としては、
- 横幅100未満：横幅100に拡大
- 横幅100〜700：そのまま
- 横幅700超え：横幅700に縮小

…になるんじゃないかな。ActiveStorageが画像の変形に対応してるからそれでできそう。

というわけでそれを踏まえてテーブル単位での制約をどうするか考えなきゃ。  
`null: false`はなしで、上限と下限を指定しておくか。マイグレーションファイルのオプションの書き方も全然覚えてないな〜。

…と思ったら、テーブル制約には値の最大値や最小値の概念がないっぽい。あれはあくまでActiveRecordのバリデーションなのか。ややこしい…。

マイグレーションOK。