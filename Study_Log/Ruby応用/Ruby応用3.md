# 2024.1.18
やっぱり言われた通り修正してだけっぽいなあ。けど言ってる意味があんまりわからない…。「プリミティブ型と文字列型をラップする」ってつまりどういうことだよ…。

今日はここまで。これ意外と辛いなあ。

# 2024.1.19
昨日の続き。改めて読み返したら昨日よりはなんとなく理解できた。あとラップする（ラッパー）という概念については[この記事](https://wa3.i-3-i.info/word191.html)がわかりやすかった。

さて、テスト通して次行くか。コード中のいまいちわからんところに関しては、この先進めていくことでわかっていくだろうと予想する。そうであれ。

思った通り`calculate_change`(メソッド名違うかも)が定義されてないって言われた。やっぱりそうじゃん！元のコードが思い出せないので、`vending_machine.rb`のみ最後のコミットまで戻すことに。やり方は以下。

```shell
# まずはコミットIDを調べる
git log ファイルパス

# 調べたIDのコミットまで戻す
git checkout コミットID ファイルパス
```

- 参考リンク：
[gitで特定のファイルだけ前の状態に戻したいときのコマンド](https://konbu13.hatenablog.com/entry/2014/12/01/070255)

無事戻せたので、もう一度1からやり直す。

…とおもったら`calculate_change`ちゃんとあった！見落としてただけだった…。まあいいや改めて色々確認しながら一から修正しよ。

おし、とりあえずテストは通った。プルリクする前に内容を理解しよう。

何度も出てくる`@change.push(payment)` `return nil`は、投入したお金をまんまお釣りとして返して、`drink`に戻り値である`nil`を代入する（結果的に例外を発生させる）ってことか。

`slice!(0, 4)`は0〜4番目の要素を取り除いて、取り除いた要素を配列にして返すって意味か。この場合は100円玉の在庫を4つ消費するってことか。

`dup`は同じ内容の配列を新しく作って返す。いわばコピーする感じ。  
つまり`refund`メソッドは`@change`をコピって`result`として返すことで実際にお釣りを吐き出し、`@change`のほうはコピったあとに初期化して次の買い物に備えてるわけか。`@change`はあくまで処理中にお釣りを計算するためのオブジェクトなんだな。で、最後に確定したらその内容を`result`に渡して自分は再びまっさらな状態に戻ると。

よしよしようやく意味がわかったぞ。これでプルリクして先へ進める。

あ、やっべ。masterブランチでコミットしちゃった。え〜〜と移植のやり方…。何度かやってるけど覚えられないなあ。

1. コミットしちゃったブランチから新しいブランチを切る
2. コミットしちゃったブランチを`git reset hard`で戻したいコミットまで戻す
3. 新しいブランチに移動

でOK。参考記事は以下。
- [ローカルでブランチ切り忘れてコミットした時はこれ](https://zenn.dev/swata_dev/articles/3e67336b635059)
