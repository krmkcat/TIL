# デバッグについて

## デバッグの手法について
### どこで問題が起きているかわからない場合
ブラウザにもサーバーログにも一見エラーの表示がなく、問題解決の取っ掛かりが何もない、という場合。ログにメッセージを表示するコードを要所要所に追加することで、どこまで処理が動いているか＝どこで問題が起きているか特定できる。  
問題箇所が判明したら、次はそこでどんな問題が起きているか確認する。  
つまり、
1. 問題箇所の特定（処理の途中でメッセージを出力）
2. 問題内容の特定（エラーを捕捉し内容を出力）

の手順で取り組むと良い

## ログにデバッグ情報を出力する準備
`config/environments/development.rb`内でログレベルを`:debug`に設定する
```rb
Rails.application.configure do
  config.log_level = :debug
end
```

## メソッド
- `Rails.logger`
  - `Rails.logger.ログレベル(メッセージ)`　とすることで、ログにデバッグ情報を表示することができる（ **※ログレベルについては後述** ）
  - 処理がどこまで正常に行われているかや、条件分岐のどちらに派生したかなどを確認するのに便利
- `rescue`
  - 例外が発生しうる場合に、そこで処理を止めずに何らかの別の処理を行って続行することができる
  - 以下のように使う
    ```rb
    begin
      例外が発生しうる処理
    rescue 捕捉したい例外クラス
      例外が発生した場合の処理
    end
    ```
  - デバッグとして使う場合、例外が発生しているかどうか、また発生しているならどんな例外か確認したいときに使える
  - 例えば先述の`Rails.logger.debug`等を使って、例外が発生していそうな箇所を見つけたとする。その場合以下のようにすることで、実際にその処理で例外が発生しているか、どんな例外なのかを特定できる
    ```rb
    begin
      例外が発生していそうな処理
    rescue StandardError => e
      Rails.logger.error("エラー内容：#{e.message}")
    end
    ```

## 例外クラス
- 様々な種類があるが、メモリが足りないときに発生する`NoMemoryError`や文法ミスで発生する`SyntaxError`（`ScriptError`の一種）以外は、ほぼ`StandardError`に属する
- そのため、例えば上述の`rescue`を使ったデバッグで、どの種類なのかわからないエラーを捕捉したい場合は基本的に`StandardError`を指定しておけばOK

## ログレベル
- ログメッセージの種類や重要度を表す指標で、ログの管理やフィルタリングに役立つ
- 一般的には以下の5種類
  1. DEBUG:
  最も詳細なログレベルで、デバッグ情報を記録する。アプリケーションの動作を追跡し、問題を診断するのに役立つ。
  通常、本番環境ではDEBUGレベルのログは無効にされ、開発環境でのみ有効になります。
  1. INFO:
  一般的な情報メッセージを記録する。アプリケーションの正常な動作に関する情報を提供する。たとえば、アプリケーションが起動したときの情報などが含まれる。
  1. WARN (警告):
  問題が発生した可能性がある警告メッセージを記録する。アプリケーションは続行できるが、問題の兆候を示すときに使用される。
  1. ERROR (エラー):
  エラーメッセージを記録し、アプリケーションが期待どおりに動作しないことを示す。これらのログは問題の特定と修正に役立つ。
  1. FATAL (致命的なエラー):
  アプリケーションの重大なエラーを示すメッセージを記録する。通常、アプリケーションがクラッシュまたは停止するような重大な問題を示す場合に使用される。