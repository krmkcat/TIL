# Turbo Streamについて

# Turbo Streamとは

詳細は割愛、下記リンク参照

[Turbo Streams（Fetch）｜猫でもわかるHotwire入門 Turbo編](https://zenn.dev/shita1112/books/cat-hotwire-turbo/viewer/turbo-streams-fetch)

# 使い方

「create、update、destroyといった**turboを使ったリクエスト（ オプションで`data: { turbo_method: :HTTPメソッド }` と付けるもの）経由で実行されるアクションの最後でHTMLコードの一部を置き換えたい**」という場合のやり方

1. 対象のアクションから、`redirect_to` や `render` といったビューファイルを呼び出すコードを消す（必要ない場合は。詳細は後述の補足情報参照）、あるいは修正する（ifで処理を分岐させているなど、明示的に記述する必要がある場合も）
2. 「/対象のコントローラ名/対象のアクション名.turbo_stream.erb」というビューファイルを作成（ifで処理を分岐させているなど、場合によっては別の名前にすることもある）
3. ↑のファイルに以下のコードを記述（現在表示されているページのHTMLコードに対しどの部分にどんな変更を行うか、を指定する）

    ```erb
    <%= turbo_stream.replace 'ターゲットのid' do %>
    	<%= render '置換後のパーシャルファイル', ローカル変数名: 代入する値 %>
    <% end %>

    # ターゲット：置き換えたいHTML要素
    ```

4. 置換後の内容を記述したパーシャルがまだない場合は作成する

コレクションやメンバーを利用したレンダリングにも対応しているようだが、複雑なのでそちらは割愛。必要になったら改めて整理する。

# 理解するための補足情報

- コントローラのコードについて
    - アクション内に `redirect_to` や `render` といったビューを呼び出すコードがない場合、通常は「/コントローラ名/アクション名.erb」という名前のビューファイルが自動的にレンダリングされる（記述されている処理が実行された後で）
    **最終行の `render 'アクション名'` という表記が省略されている**と言ってもいい
    - ただしgem turbo-railsを使用している場合は、turboを使ったリクエスト（ `data: { turbo_method: :HTTPメソッド }` など）が送られた時に限って、「/コントローラ名/アクション名.turbo_stream.erb」という名前のビューファイルをレンダリングする